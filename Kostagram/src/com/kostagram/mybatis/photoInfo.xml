<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="photoInfo">
	<insert id="insert" parameterType="com.kostagram.service.beans.PhotoInfoVO">
		insert into person values (person_seq.nextval, #{name}, #{age}, #{job})
	</insert>

	<!-- 내가 좋아요 한 이미지 불러오기 -->
	<select id="selectList" parameterType="com.kostagram.service.beans.UserInfoVO" resultType="com.kostagram.service.beans.PhotoInfoVO">
		SELECT * 
		FROM PHOTO 
		WHERE SEQ_PHOTO=
				(SELECT SEQ_PHOTO 
				FROM LIKEIT 
				WHERE EMAIL=#{email})
			  AND DISP='Y'
		ORDER BY PHOTO.REG_DATE
	</select>
	<!-- SELECT * FORM PHOTO WHERE SEQ_PHOTO=(SELECT SEQ_PHOTO FROM LIKEIT WHERE EMAIL=#{???}) DISTINCT REG_DATE DESC -->

	<update id="update" parameterType="com.kostagram.service.beans.PhotoInfoVO">

	</update>

	<update id="delete" parameterType="com.kostagram.service.beans.PhotoInfoVO">

	</update>


	<!-- 내가 팔로우 하는 사람들의 사진을 모두 가져오기 -->
	<select id="getTimeline" parameterType="com.kostagram.service.beans.UserInfoVO"
		resultType="com.kostagram.service.beans.PhotoInfoVO">
		SELECT PHOTO.*
		FROM PHOTO, (
			SELECT FOLLOW.TO_EMAIL TO_EMAIL
			FROM MEMBER, FOLLOW
			WHERE MEMBER.EMAIL = FOLLOW.FROM_EMAIL AND MEMBER.EMAIL = #{email}
		) FOLLOWER
		WHERE PHOTO.EMAIL = FOLLOWER.TO_EMAIL AND PHOTO.DISPYN = 'Y'
		ORDER BY PHOTO.REG_DATE
	</select>
	
	<select id="getMyPhotoList" parameterType="com.kostagram.service.beans.UserInfoVO"
		resultType="com.kostagram.service.beans.PhotoInfoVO">
		SELECT *
		FROM PHOTO
		WHERE EMAIL = #{email} AND DISPYN = 'Y'
		ORDER BY PHOTO.REG_DATE	
	</select>
	
	<select id="countMyPhoto" parameterType="com.kostagram.service.beans.UserInfoVO"
		resultType="int">
		SELECT COUNT(*) FROM PHOTO WHERE EMAIL = #{email}
	</select>
</mapper>
